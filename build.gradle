apply plugin: 'java'
sourceCompatibility = 1.8
targetCompatibility = 1.8
apply plugin: 'eclipse'

def props = new Properties()
file("dist/ver.properties").withInputStream { props.load(it) }

version = props.getProperty("Specification-Version")+props.getProperty("Implementation-Version")

repositories {
	mavenCentral()
}

dependencies {
	compile group: 'commons-codec', name: 'commons-codec', version: '1.+'
	compile group: 'commons-io', name: 'commons-io', version: '2.+'
	compile group: 'org.apache.commons', name: 'commons-lang3', version: '3.+'
}


sourceSets {
    main {
        java {
            srcDirs = ["src"]
        }
        resources {
            srcDirs = ["src"]
        }
    }
}

jar {
	manifest {
		attributes(
			"Manifest-Version"     : "1.0",
		    "Specification-Title"  : "Jtrrntzip",
		    "Specification-Version": props.getProperty("Specification-Version"),
        	"Implementation-Title" : "JTrrntzip",
            "Implementation-Version" : props.getProperty("Implementation-Version"),
            "Main-Class"           : "JTrrntzip.Program",
            "Class-Path"           : configurations.compile.collect { 'lib/' + it.getName() }.join(' ')
		)
		archiveName baseName + '.' + extension
	}
}

task distZip(type: Zip, dependsOn: jar) {
	from (configurations.compile) {
		into('lib')
	}
	from (jar)
	from ('dist') {
		include '*.bat'
		include '*.sh'
		fileMode = 0755
	}
	archiveName baseName + '-' + version + '.' + extension
	destinationDir = file("$buildDir/distributions/")
}

assemble.dependsOn distZip
